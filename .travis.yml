sudo: required
language: node_js
env:
  global:
  - ECS_CLUSTER: pruebita-6
  - AWS_REGION: ue-east-2
  - secure: k3mDpzcQOKYrXuDMbpZb4m4PAL3EWgMYFfs33SdHSELmD3hxcTYMyirJhT4795awytYPho6rnUv9fpJRxURhqbWTgPmX5aB8CJv9NhzJQr4v+3TkoHa214LTtPbue9AkOIf2tnbJ2X8f/+CCOrt/sZtCGtxN6K2E2IC2errqGKMi7wQBnfxPZD58qNBaAqNFkGQNoWV8XQhVPc0/ZUGkgnVzDOABi9GtXBV9kMrrgfFLmCwMzh1UAgLgV4da43u4iDYTp6duBc8F2Pi/+p/vse5kl+WIHot0Rz9siqYqOQHPw/FHNkoU0cGNeZ8DiC+TytqjiFYWOccB4PXMwYkU97hkDOcJecTs1Fox1tk9gBYD93/+P0RWo9cyYqoKUvkprtSnFOy4jSD0zRnjIITB0QJ9T3JeRTUhBzkvcjT7Wm2leU46J9yU47TmSfx/KpUu7PYA8JO2xqt/0/SsX9q+ZEhUYdCBQpi9442mGhKVnd73fDPpiKy7gJSmFgb0ZRoauo8CUTMXQ68Yuk0qmx7mhzBL5zDMofcXd5Z6ooXCrUeu89NLfVXKIaT7acLHZM6vJKV4DFpJyvNQPGOkc1+4F5N5GyIOFQUh3qWzjO9Fz60WqbeZaUgfggQ8sovaD0jkfoY6Mk54VQIHSaDlTBoRRMGwKps2FCMOlK8AWhW9I/8=
services:
- docker
node_js:
- 8.11.3
script:
- npm run test
after_success:
- docker --version
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- echo $AWS_ACCESS_KEY_ID
- echo $AWS_SECRET_ACCESS_KEY
- eval $(aws ecr get-login --region us-east-2)
- docker build -t express-hello .
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- export HELLO_IMAGE_VERSION=$TRAVIS_COMMIT
- node run generateDeployFile
- sudo curl -o ./ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- chmod +x ./ecs-cli
- "./ecs-cli compose down"
- "./ecs-cli compose up"
