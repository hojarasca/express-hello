sudo: required
language: node_js
env:
  global:
    secure: ztwElLcfLSaldxpBSiAqNwBx2fJJ/dw/m/tAQmeYnSV8napMpGFzmiUwpAqhywUnhxwEN9fb1zDCJkIZOuK5KgduWIBoP8kL/UlMvzS7TlmqJpOOP1WPxjlZX2mL/i49GwUWFqc3CeNPr340D1YBaYzXe9WyWMMAolTR/g9PUIsFQRyDgZiDIrhpELbSiYvQvfpG2bjTfH9P+c7Aww/vTvGN0hjoPusUVWa62Vz4FjNRkIHZjT010yJ+uTQF1MugfbqsqeCCMX7BXm63DTxLOPKqN6UPrgQyjuazme7vOS4QaSRSscO001yUjRAL0dVtVChodPIAgvWJKwFqIhk7qKFnEugDU2p/sE352RHEYz/RXr3+i6GDiT51IloppX2+H0U0pcJCRcrXN12mjkQc2fZQGCOEHo88ws1vw+LXBqwV30LYRTO+5Sje2Dy5tuJ3XCmn1uOhw+7XawhmgnbTmYli4GEn7QUWAw7R67woBoynsBEwt9pQdMnFs2fKn9/2Uetel7rK8qgY6mO9957sb0bDhSld9arq5xPI9qb0vnUQxV6LKEje6ut57Xto6CRHN9GVz7/wlei27IVMy1th88KAmPsby7XTS36KNJjxj8SRTyLTmonHnPir33B7t30w4KIULGSItBTx9Ncm4a9QsmWppHZwJQ3KeJAtOEzqPVk=
services:
- docker
node_js:
- 8.11.3
script:
- npm run test
after_success:
- docker --version
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- echo $AWS_ACCESS_KEY_ID
- echo $AWS_SECRET_ACCESS_KEY
- echo $MY_SECRET_ENV
- eval $(aws ecr get-login --no-include-email --region us-east-2)
- docker build -t express-hello .
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- export HELLO_IMAGE_VERSION=$TRAVIS_COMMIT
- node run generateDeployFile
- sudo curl -o ./ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- chmod +x ./ecs-cli
- "./ecs-cli compose down"
- "./ecs-cli compose up"
