sudo: required
language: node_js
env:
  global:
  - ECS_CLUSTER=pruebita-6
  - AWS_REGION=ue-east-2
  - secure: fcdMYNB3kVAdS1XGjOLnXrg410yulj64WxGK/mNxPA1XNvYBd1BAlFzpggDM52vsT0GB+LVdDVRaXH/3JZMDbIbvy4gjtlMvL37v8i9O9ex/bVGhCxtV03l3RyT1GSyz9NfxTxIa7PfiJPbtwtrB/pn3gCvDugDp0J0P8YZyZqV4s87dHQMYL8TsA7w83GsirlIjZNJgcIbQ/QlQxrteYOxub5qnwtvw7wirc+i5JDUCaYXffJcvgx+nFtnatWnBEpkk7MMTf6Wtk8dgRI7dEwpKrd4w+uR5OYXNPY0jQ09lbNz6qsOc3G6mR8+qPJoV4E7DF7ou3lllh64ba6QhtydXyfDU+pFltivgnNiuUACQXZK/wllRuCposT07jnU3dECR0GG45SHT859F7fE+nvEkZvVzcEhSZifNxTddXZLpc5FA5w39fiBEuUokqCC7OqZJe1DbThJ9hmUrkUTGUmZc/ME8uw6cH1Bv8kA9gdW4JwJinvb/6JI9pKRJE927LsXlxDVbaQfKlj1ZW+eunjUTh8uliEvRlEtJENRj/DpDeBF+SUniWKY1VGap9mtRRcGsV0GDnjfswJ79ip6srPc04XTEbM1EA47fzlfrlpzDz3T3345T245d+ATx0P/44IpwWUfaHQ23vHv2IyyJPALhpczKcnEwHjf7GyresjA=
  - secure: yzU/0Ko1Qxe9KGXAmITxM08wzNIf8C+4fwqd4cQcztIssm8v4c2fOPjc5dCHwRM3wb55VnxMd2giR26zvSFMmRzsFeVWjghpjOmmea5s/v5ZteKkVpeuE+ZBrOPtZGf4hE5mSmZEZhfzuHNB1iviW3jV2z6dm7s2/Z23ZzF6OXFD9ohweB8VPrq8A+eYkhJ1HBkNSZ2/ui0oo3iLERvqFohWJFz0Iw3c6pGUskBc7tpL+9hptBRMPpffKX+YjdMK+Tuk8ZwRXIznRz4D2d7t8pUJCpG/XODEVz16hXn83pAKpEwzAypGWTMAfwI3TIrkagVEv+V6jbuWEktn1a9rmm9RsVHdxL+G2GynT68oXiWMdkynRE0bxdruQChhTnyvuugvxdrK5LMdwycczSjfNpkgc7Z1o6suzXMBXMYp/0zQ1MOPBycwEdcRu6MCwwHlxAYFNWYWWrDqaeMlAz5MpEx3fdQUKLAe1/nS/KGU8aSlQQU5rMdpz7pgDHFelQVundC1R8SlNZ37DxX3GGDdu7P4a9qK567lEyPjzXjSpa2ZM/a/XGsg/GU4dvvMO84M9RBMqJCOVeltYU26VNqqWscuJ/pTfnI6NtKJ1ce2vqq3f6M324ChY1NSwZr9l5rXdr2TxOgneS5IMRnU6NyWYU3ZkeLBHF2ameYy7RpmbMg=
services:
- docker
node_js:
- 8.11.3
script:
- npm run test
after_success:
- docker --version
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- echo $AWS_ACCESS_KEY_ID
- echo $AWS_SECRET_ACCESS_KEY
- eval $(aws ecr get-login --no-include-email --region us-east-2)
- docker build -t express-hello .
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- export HELLO_IMAGE_VERSION=$TRAVIS_COMMIT
- node run generateDeployFile
- sudo curl -o ./ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- chmod +x ./ecs-cli
- "./ecs-cli compose down"
- "./ecs-cli compose up"
