sudo: required
language: node_js
services:
- docker
node_js:
- 8.11.3
script:
- npm run test
after_success:
- docker --version
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- echo $AWS_ACCESS_KEY_ID
- echo $AWS_SECRET_ACCESS_KEY
- echo $MY_SECRET_ENV
- eval $(aws ecr get-login --no-include-email --region us-east-2)
- docker build -t express-hello .
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- export HELLO_IMAGE_VERSION=$TRAVIS_COMMIT
- node run generateDeployFile
- sudo curl -o ./ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- chmod +x ./ecs-cli
- "./ecs-cli compose down"
- "./ecs-cli compose up"
env:
  global:
  - secure: GUy5ly8oWukq2bs5G54LJC6hxVZwo0sy8UsyxaE40cQooZEXJsggjDfobLxea16Sw+Uska/Hl8SFDDJmdigigtUq+zC1vNp5knBRFncsWzQ5/rV93l7MARoNerOYVdRjBrzOWn1D52pan5R6uxYP6qNzJY4rlAazoUf6hxO53CgTLgOOwMSBKe4f6ewO5H5JNe3JhEMQ9w0osCY6HyLImQ7jYrj6sIhjR7w8UsjjYaJXnhYvXRGcdIECX8Kl/Fn5H7g8BgalfqMFDfPyqnLuNJQBuDxGVvRShnWt7q5EHOtdE9hI9pV5f+KopUEYO2TBmKSJJPGFaPNjYYeJUb7D6e4e3Y8HVLtuumrNhkD46zIkMNtlHFWlr3J4K0i2SnIhxRVnJBNPWFDX2WXJKRJT6+7mEfnvRQaaD5sde/6fKBrXRnPXdA0eXWjVAY809HTwNiVieqtiCbuDM004X6WYZnDziYrlVdNNqlwN+zDiZ3brB5n6y0Z+6jWRdhvajPlVak7Kc+PIexGJTRwJiiWKy1eIht3+itW4OEfhEfHAJ39Qt/VvyGK3PDglRu/prY63D3BUsuYqKsk6omulKolM64t2ombT6rW+kJ3CRFepJNJo43YaLEpCyGVGUCVVt+7d4z0SD3PHLR/oth32V/Dpvx6XxwJDfgkEQsHO/yXAlL4=
  - secure: syBKJddtq/UuP0PqVNZwqDDkhD/sBZD1ow23s0m7u2nEbub9Ea956vZXmN+pNjtnYpH4z69rhg4xsaK68AXr+VMGbns/gh9+ibfBNpJAgX5BFfNRXy6zDfQAG8Fb5XJAIsyjylfFk781MMcz+JDvnyrG0jao8/ZaAyotP+UE2kTk66sQHULbtP7Ch4uR7GFDt2NRFKVzR8XxFI3gSN9Zk8IUEdvjCSeuZvyKpHy9X8q9MAr1AZfRaDT6IYjOdFOhUqvD/w6qNjPNHIrOTF6627KwtvZKsMCwPFhHj+WAx0jPQ/fczvCxJVpEF9AHt58KftJ4vuznZIKCNSTHXHvUFVTuXyk+TCj5PQR+8wfPiZLZzVUiPjkljJI4qTO6HsLmzKLPJ4BMkzQt2MAdStMssv4nZw46ArWkGQaevTPaXCs3BES/V2P2AOj8MB7iGFuV3/2DKko+3wHW7Un7pjyRaV111cGQo0kyqE/NzfVRgaL0yDB8VsfhVFtmyP6AVA66y5RC8cAYmwBbHya493lWT0OUruMAL8mI5YIMTI4B52vmvup53AfcnX16uquf1Y0NEWi3T4YH+Pou9ug8PlYG2fowUJ9RrvPa4HrOn3oBxLvXRO1YAYHhLKqyueEHbuhpK0qjgt0UMfTYheJzJPeq5FWUavTAPtNXrx3aUPbxvSA=
