sudo: required
language: node_js
services:
- docker
node_js:
- 8.11.3
script:
- npm run test
after_success:
- docker --version
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- echo $AWS_ACCESS_KEY_ID
- echo $AWS_SECRET_ACCESS_KEY
- echo $MY_SECRET_ENV
- eval $(aws ecr get-login --no-include-email --region us-east-2)
- docker build -t express-hello .
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- export HELLO_IMAGE_VERSION=$TRAVIS_COMMIT
- node run generateDeployFile
- sudo curl -o ./ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- chmod +x ./ecs-cli
- "./ecs-cli compose down"
- "./ecs-cli compose up"
env:
  global:
  - secure: Vdl2qFuVjJaXoB0ey3z0UhzqRv0+ghFkyfGTloG3rKrWvbNd9UpbWjpDVDOAbZBCkKYSeNdgXhwJU8/rNIr6t6LuaiXVOLn14WvPwboWH1zDEdJASc+fSc7v2XFUDVBEevpaM4QGZuhXs4MhoqHlR5YQ8eF/6spUJwQd8pA8YrXPc9uCht619GVHl+nstd6msRfBSmn88psEi/cevGjwSATdYkMfb5jD5xKUnQErTGGqkcx+Xrdv061oElflVBNGXFSM4iTd2uCbz+0K/f90JR7yowN9tN75hn/80H5/jglKvQd64i5VU09qbQfgdZwEOOKrmeg5h1sbZBr3ocN1Uf+iPdQY9oxzI1yo8HHNLTrLg2uupjHRPB3b/a+a7o0f5nbfgjdZDM/lOlhi1IYMV1eWXuE3vGIK0a5n4poN2fJ9fzH0/8R346/qCo6VS6zy5CjsEnDb7swgB/8XRLb+R1AMB7CtAAXUsOc4gEo3y8tIrdrH48Hdze44Be+/lGjUfhykBLQAJ7alHhvrzbHaEuZloa5lYMUdmRUx57n89FZM6TaTqyrSQjYqhwid9kOelS3eSI+n+75NMDW939iDElteNWlJaChOMdyLWGE0c1je7l+3tR2ogYvo13cbrljh98hoO59+56rc0Z+I0LxKO699/VBwwOmEIxKcC+Rif4U=
  - secure: J0cjP77aZEkUk/cSHQzT97rbECwJbUmUlhI9AlvyG5eFMXhSZDlNwBcVaytgo4KO9EROC8O+NPSUPq5sLJBBvfEZLfw+W13A7pqZH2In3owHqV0XgKK9EolhfDFpjUm11q5TYfFFEJSlFVBmL4C8unpKnV5JL9cHnXBA0FVHE+ajep/iZDcQa8vM1ie87W+BrRZt3KiJonuGZXFOmdUP1wxseW3+4fF612JrQNWA4XBhbHpF4cvE+Zx2IGSNs0OYCnyJXuz9D9OoSSDp8csqjSjxNEtajwA4RoCgxpS1ykTZ6DBVv23QWTZg/c50Kqf0JE5EQ6M05suTz3AeMi+Zzhlu9uEnyEld22frbSD92hfAfxTHfovyP4rygBKrooKSSUMDibRazHpW1fUIAgUwiGW1cBYiKo5pADp0MK4vt55+GukKIGK7HRqqHQa8lfw+mHQGvaNJ9fyzPMDlacm2ek10qa+4FN4PJrYZKQz1cr++ebnX8nHq8BIbcrJnHttdL5Cx226JOMFv+anM1xOXEIuYVaymu/D6YNTStinSWR/ILwb2SahvHAQt1TRwvC9v3txvCh/bvMFVh59ZTQMjgcvhPq/TokzFBnyqTjYrVF9KMV7UdjmXZFq5P+/Qzew7WX8M8UFmxvZiITCrF9QtL0bUEjWmygWPUUaNn/7LrOg=
  - secure: wSMFDiDPMCAppDwwVf6+JM8RYG6NtH6TWqDL/G7BNp/o5z1rzL+9xxJq9C/S6cKgTQYQenFcGcvEuL1Fr7x/ao59qCiIYtLxJEhiIaU9ALdAB6ykIBMpGqipwItTH75dyL9LcXDBks6hdXtarTX83QkBjip0mKQ8bVvh2f29zAsL3Q6t0moUW/XAQQCLHB84POet99hCelqr57cI0XRmUI+bpJz/d4kEsg5NdelvGhYgt6LIocb9JJNihMpqKl84VA8FAPdJ61Lzj6i+7LHKfKRw9TD4Un2pDeMj29auYU9gu16qD0RAgiabHdIt5IO4sQHOZtx7lFpqjtxUi3v6lEPT4PDPlld+auFOVCZX6KPEpLCbjJgWiFmOFQlXkl/NH8fNplIYm9vbEprdyZrrf3BV6rZ9/Twp2yCqpRqPe6fyquaAWlMW0oyz8bu4YPTms+J2GKws7nmfSdS2eVe9SMb2pkH1ORp275pFMC5gnwj02ftlbZWc+BbkxOyzqfj/rqDQjfnaJhT2cBlV0VpkQsbh/GdoL6lpwSJsllwbesWZ829Zc/ydsO3yjbPoXuYNOVH0LHvEuVWaVOfY1Ny8NtESPrmL4NsnG6Y/3V4Svfdf8dNhamwzh49ZXHPBssqMBscUMEyuNPikPKrvYg0l/ekzK92BqtVgYr4hxlPCMTA=
  - secure: wNU+Y22gUfRoo9PwFOxVNM729ZU1XpX8cCX4FkaSoYoRdhpZDfqt+ciJExq7vbY9eTxY9AKqeMLgRUZkvb5+SKrh8fOx/3I1smbqfUeSSjyhWUWAWre95UUmelDEZ0OIQ4heia61IBqQwAYM3bhYSepLbsQxnLHv581ejteOk1kij8gGbEJGW5fjf+gRCGP9NU/WlGcn5dFlN4r43Y8oI4j9Q+V42T2QQ6JM4dx5V6GF4h2nyfUf0UfRVCr+YplvYjvYzhAmfHw2ELJb5PP9o2B/dMSlT4NSx9++EAjuh6Q4uEciUYVaqkBDV4Xx/YXRse7tPrCXooBOmNoTzyFwecCENZVEGzyqSQ7wwgmLpLmNzFx3zBDsWSRccENlJ/paSxjUERq+liZiCrKuWsSuDeXVGWf3+/ZXBJZJJEBz+Kw+sQfNAveD5eU5qIN70CGGmZWwLwFdR0thniDnCoMj/pLzbMLYX2J2mkPQVecpStXvYGHzkPcv408sZMM4gw1BFjhv6F+rWl00vzDPJyRFLPiov5XfgPnnZr0cRWRo5EKFJ6Dpk2sshZgAY8WtewcnIMVtNvorNpi+ER8EC9XrW6YEry6G5zv5yvQ8qrJIttz13H37QpNUM02HzI94ikzu95apN8yrMFbDT/di5dI3hmnQ1AeNg/BYIqYsyJep6es=
