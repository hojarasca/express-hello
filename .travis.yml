sudo: required
language: node_js
env:
  global:
  - ECS_CLUSTER: pruebita-6
  - AWS_REGION: ue-east-2
  - AWS_ACCESS_KEY_ID:
    secure: "dgWfp6ADzOfFglygdrRlXpyRPkZrq+N+/KYha2iVivlfN4a8UpzMsk4xTO6/uxVUq72gQIikPeHVt/X9LsQ4Bz+pm0CIq8W2CzyaNGQmt0wQQ8rWLGmLF1cOS1DlL18ime62AJI0bcmlvZADfFTS6ypLYAvE7sKauWO+1R6KUWzNf49kmnsiVvzezB2io1GFlFWWRtfGy0EmX5YnKdQ4gGSX0rX6iF8Gf5OUjJQY+2lEboBqg2TKTMaq6NhjiULZejPLu1x/6YDphatpehBtClBLAxsz8rHVp410huugrS6GMKyJdWIMZ8SQfPuons2pwDLy9hg7wcZjV825L34KoTYZtuzKwODx8hNycKQs4fVmX+YsCGI49FpwgrO10+mtdzaZR79zgilzSKZTJm7rwDcNPOiozSj7L79Z9I/UQUW8nTYH54um4ajcdS1dvzcx5hH2mAdvyA7Yu3qyX6Z7+jNoLT1fPh+iyzI9oOI9xhTo6hDEz4g9A2dzZoJnJwgf+wrmf8EV8lOpvoKMKdLVnA1tc/M5lhzJKwYD97Y3oAQAaPYRJNzKt1ib6c/DfUf7jIlV4xDmkJnRbNEHW2fy9GWH2uTodYMxgGUFWny1dlrRN6sqn7v0Puj0YOazAJ5zSoybatcXvpADq26akYAUNhv69o3UENZw00UDb4nv/kw="
  - AWS_SECRET_ACCESS_KEY:
    secure: "KNfeANHV0/hZjg4ofAEU8QGyZQHkz7RHDH0wH5OcgNkbeMu/I+278bXSiMv1zGk+T6LzzGH4WMZ5pJvvULZI34Cykjz2nA7zunpXbWyABGh8AKMww7Po9EmWuD5n9KSLJ5cYdZHeX9HKRCFXHNn+BR+bJjWmTqsXMvdadNylyHLH2FYlERezmb6mZZib9nb9tyO09DQHbXkkj4rqcHY6mqDTIsB7gm9CWDvje9OKj5w0vUOGbnnRkdUrr3WdIM1oJOntIe23LcL7YvfLZUhFoI/U+B+QYBQoFtKSejhgPy9uK8vXnyXn1bcyzBwO6ZZraC0v/4Ziec7/TVo5fQpYsqttCvNxLBBAWotmRDajDpxILeLmszZeGFcrB8nQXgxJI/6Ra+OGebOZ40cG+cgjiN68ebaXeZ4MnBg8xTjjYsIMN8ZNwZsgVHWAeCc+8TBB7F1xIjEnkMYpdDMG40hxNrWfTXDtgZemVV7lgHxSW4+RLuKNbqZYF9rMkLw8QKbB1iDDDggIQpQNhuqMw+1L7J2y27TdK67l85FuKFVwIQ/LaZBqinVZJtaCv/LR9ZE9slAyYhUwXpZTtP0Mi8wfFYx0jpeSspqF1Wdv2DcYzgUNvQymNwoUzBJQPkjFT5uA9PfEYttxJ7ZMUTZ/ZB2XvnQ8fCqonRXvX6kAJq79uRA="
  -

services:
- docker
node_js:
- 8.11.3
script:
- npm run test
after_success:
- docker --version
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- echo $AWS_ACCESS_KEY_ID
- echo $AWS_SECRET_ACCESS_KEY
- eval $(aws ecr get-login --no-include-email --region us-east-2)
- docker build -t express-hello .
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- export HELLO_IMAGE_VERSION=$TRAVIS_COMMIT
- node run generateDeployFile
- sudo curl -o ./ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- chmod +x ./ecs-cli
- "./ecs-cli compose down"
- "./ecs-cli compose up"
