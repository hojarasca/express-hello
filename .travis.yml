sudo: required
language: node_js
env:
  global:
  - ECS_CLUSTER=pruebita-6
  - AWS_REGION=ue-east-2
  - secure: fcdMYNB3kVAdS1XGjOLnXrg410yulj64WxGK/mNxPA1XNvYBd1BAlFzpggDM52vsT0GB+LVdDVRaXH/3JZMDbIbvy4gjtlMvL37v8i9O9ex/bVGhCxtV03l3RyT1GSyz9NfxTxIa7PfiJPbtwtrB/pn3gCvDugDp0J0P8YZyZqV4s87dHQMYL8TsA7w83GsirlIjZNJgcIbQ/QlQxrteYOxub5qnwtvw7wirc+i5JDUCaYXffJcvgx+nFtnatWnBEpkk7MMTf6Wtk8dgRI7dEwpKrd4w+uR5OYXNPY0jQ09lbNz6qsOc3G6mR8+qPJoV4E7DF7ou3lllh64ba6QhtydXyfDU+pFltivgnNiuUACQXZK/wllRuCposT07jnU3dECR0GG45SHT859F7fE+nvEkZvVzcEhSZifNxTddXZLpc5FA5w39fiBEuUokqCC7OqZJe1DbThJ9hmUrkUTGUmZc/ME8uw6cH1Bv8kA9gdW4JwJinvb/6JI9pKRJE927LsXlxDVbaQfKlj1ZW+eunjUTh8uliEvRlEtJENRj/DpDeBF+SUniWKY1VGap9mtRRcGsV0GDnjfswJ79ip6srPc04XTEbM1EA47fzlfrlpzDz3T3345T245d+ATx0P/44IpwWUfaHQ23vHv2IyyJPALhpczKcnEwHjf7GyresjA=
  - secure: NUFIDk5h6ihtqB+kPyO2844H0HTGx5DYzI2jFh/+2VvieNVpz1UJSPHcaphUbQaLKp9Sqd+tOBautztOcd9Kz9Qqfp5+OcM1kInk1ZeGBCEnZUhltaX2CkcS+DJnKaZEh3zwbhb70X4q3vGas3MbgX34dBwFXBXZon8mcGKmoy8zR0sKuDcqMPZwfsWhFyzQdb/hde2P6U6PLtYWzGYhwDp8ln42/GiVy0zZ7UekkR61ZVyxa+e1kO1SqWZfAZcRsKpcuUffZFDXRNF6OpWpkOFJXAUai1oD2pdGZMnlHsOGb6n0GXMMC8uHPGvnUt7Dx/h3b81OHYX3ddfmLuQUjMSAhpemzhAFuvym1WiSbZ0kfKJqGHaNWhix0c2Ob8VC1rW46Z9isJJCQ3ALzY4Gu8A6OjlwGHyIgJvuWNqJJbV+LGhRULGXxzmnNKtqEWq4UQLJwW4Y2jIw0HmSQ41nH7GmDSRZsxXCBP0gQzz7dNwLVbCLG7JadkEFetpehocTQWGOBaIthldiHTRJ3z1Uyrr1w6T3U2+bm7dARFNF0VyMq83iaAo1wR6oG2I1ZSIwwuKTe4VI42+LxY78TJvfkzdsafWnoN2XWLtaiLvEf3qZSJ4ubuPQwroR11roL5Goj4OKqQ321wuWZ0gBkf9+hSN4qKM48kEc/KtvOncya/A=
services:
- docker
node_js:
- 8.11.3
script:
- npm run test
after_success:
- docker --version
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- echo $AWS_ACCESS_KEY_ID
- echo $AWS_SECRET_ACCESS_KEY
- eval $(aws ecr get-login --no-include-email --region us-east-2)
- docker build -t express-hello .
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- export HELLO_IMAGE_VERSION=$TRAVIS_COMMIT
- node run generateDeployFile
- sudo curl -o ./ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- chmod +x ./ecs-cli
- "./ecs-cli compose down"
- "./ecs-cli compose up"
