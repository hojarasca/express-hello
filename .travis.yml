sudo: required
language: node_js
env:
  global:
  - ECS_CLUSTER: pruebita-6
  - AWS_REGION: ue-east-2
  - secure: UC9DEnS/ciFEyOAcutr58qOamG1l0nUBDDp1uOquTOXIVnwS8HtEWPH47PJoIXMjkCHRN9HCi0mx+1GwyVBEaNMbtkN19eYn8Z0OerVIAlBkNi1eLlD9UhoJuVjs1Yvak1N9MALUSDy9l5OsxmByAi8Dvq8p6J1Bggidqm0lwVNP2MUZDGmLmWQb1eAy2T0GmILRw+n6/Qx/K4ZiBLk7lK85wXNLsXNa9C/TDbJYuyL4a7311zY8iZaCzXbOuJ+XY9QUovn0emtF8TbzKaawLI76ApQN/9yTFP6Or3/UtAD1KH7nLOMW2GBlDrKiUIlqrIVZG5OJaQ3ETTotuMqMc35YZdFBonbPuiyhjc4dvGfT5snsfaQxR+n+GgNz7dF4XomwJMJyAePYj8IFZiX0pOBOmaha6/6XeZ8LRXHhBBlz+occQkWKCBMV1KNi4N1fYDrbC9QNE+uWKXjb/riTqU5fFeteihO8whBfOgtUG3vgYWT0F/9Ayk4TOZrnzIBXaPv/iF9N8X5Wq13/MA6RmvMM5BThPeYvkTjlt3Wl/a115/nN+zEa7QvnReUyY4MwOsT859oDfRL2hawDn8RjgX2Xif87xI6lSeOGXvBZTIJCCoDj5+0UrIcmiWVzLU58vcQmMnRdDxEeIbNXluonoT/cTYKw1jRdyWtfy3Bj3gg=
  - secure: cCKRJNQ73Y+jLGfU4mdfJsjCRaDs2IZFYZJz9Rf0VlY9Nyn0UhrqP5FdbTU34uwyugL7DXnXR+doRGcz/sA1AWTVjxGMziEkwqS1a9lKwOg3kV+yz5hCrycSHSvwDmWW4K/OJHOb99f18iKxzZwfiW/sL8G9BVjMdEF7UdilpHaLyt1S5ooFt49uxVuNMTlk6e7JXkHGGCCufCBTQfOBuaC2yYEo9/P8gN+Na1qsPh6rnygDlTUpEVgYAzvLfRSj79kDi/l7bFfJvG4+3qRnYC78kgOV1Ba3Z5TFVM/Ej7Y6uaqZ/bkSfMmSsiLwTeFoDY+MWFBRQ+L3P5K+lOp0I7T/esC0ueZnhXHKWDgOytxSH8FqBAa9Z8oS+AbN/ScIIVYjLyAQb06NkZvb919JXRK91WyC1V1smGHUy/yOonYUlpcW39ekQNK0/tYoEqMamdggUg4vmy+k9mbRzS4IiuIqdV5OJSwiwK9U5YneFffiCXG+5caJDR7gsk+3FK40z8kjQqPrXs5356d5ECdkGAqTAOXD1dTH5GV7MzKXo4VHhCXqT5UNBEmU2jWr3H0tjvupOWFnow8BkD+g5ecBurxRYX6rxb22XYZlzqOInfzG54ykv8ZKFha7qBDagIxyKgG1lgkzccn+RDpFJcqR+MNn3qOjuNbA1zX9xBe3rj0=
services:
- docker
node_js:
- 8.11.3
script:
- npm run test
after_success:
- docker --version
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- echo $AWS_ACCESS_KEY_ID
- echo $AWS_SECRET_ACCESS_KEY
- eval $(aws ecr get-login --no-include-email --region us-east-2)
- docker build -t express-hello .
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- export HELLO_IMAGE_VERSION=$TRAVIS_COMMIT
- node run generateDeployFile
- sudo curl -o ./ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- chmod +x ./ecs-cli
- "./ecs-cli compose down"
- "./ecs-cli compose up"
