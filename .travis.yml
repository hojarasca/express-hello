sudo: required
language: node_js
env:
  global:
  - ECS_CLUSTER=pruebita-6
  - AWS_REGION=ue-east-2
  - secure: RZfvH7z4H/Z6QYX0Ax1c5M65OJ3oFbE+Q4p2nvYQFvPXU30zBbui363G3K6MQz04/nKpKBs9T2Tic1J9IHTBJrUUbnLLwfdc+A2D6jA9Ux8UbAH+TXTdpXDzt3HgArfZ+CCXku84AAvvrW5YtHHjDWUrAgEElcqZuWI6kdxFTkSPoj2qc3lzqOBRnRcvXsTOhec/01J+JLNwFfRD60ZDmz4df+hJTmP6S1/TR7ja5nta3wP3/nmDkxCQTZxZqK0AjCIRZvD+Lyi+eEBwyuiUJw208dsPtMmu4U08q9v75C4rPKlqBJc83RCfGXHXTpJX1NOV8fLSphkRfvUBd65ATOacMAL9SPrNQHLl+uNe/1Hc3TcBKUMiu0AtPVxeUNDJaavwVw4+ZBG8yEkFVIDNn2rURjMFYKy/yXlXvFYxsDeRCATbamGwsaxTCtivCH58NBioxU8RC6zISbdZ9PEkgZOBHsjm1EmHcJhTEp63WFODOBtOoy91y5zKmHge4w7yYXluz5LAYXBlAoppAihbBmblM6aoXCCFjRJJRt9UkhpDH4tnfKfCjmUdKb1MskUBlK3u2ZNV1F0JtGRxUF43DXhpkAjk6yIrLuPecaJv6pSuUwWwQlqPXaPprx9RF6m1b9fcw2d4CElSqFq/gh0WdOOzz8Z11gDsf5DtUmZfNSM=
  - secure: JiOx/xVoisRp6+hL1OJlubk2T3nE2WmsG8uBiLF1FaSPtvg40QJtsjmhdM2e/orMIRueBzBNBiq9FoUm6yB1ECIH2NKLGebM4nPiiNNyH2jOOtV+HW8vtsJ8g7vpFLmI1Pf8SOmenMqTEEmvnxmGHvd4+W+KCi7p7nX0ODeq+BBy+q2LwmjAsdxOP1KHeaTtYMvTdshVGr6E3T591Elzh7Vs1cGkufCPopmnK7tBicCNMI15bW8IUZN5QMQ9jRxu4QouLUoeGrMLew6j4tQPW6uN3zm6rmRMutzNSOBzRCBep2wUGnN37JOO21d3YzD2o2FOPxLoEYLH8rkN8NGQ73YmTD/D0rLnqDYnnzuSo1+8V9n5DIdTq6Hl/ZgTu9eMAO2SoGBMCGSVlFYbKgxsrPzy2Eg36OR+EVUPR/tZLsABfLJRouTZEQTgato2+VVoPTx5iNRH68o0XYZf3OEDcK5/weHgX4CldxV4kd03wCjqOnawxVGvyB/P2URaJK//mZqLvDir7sKr+D00yIInUg9eqa7cHrNVZp92fXcY7lsJ7t3ie+tD3+9zLpI59iGjKXi1CtTsx3l/xamhu4ofGv5Q/cCfik3RZHmFaPDkjYKVL8mCeK57g/5V7aH/ZnCJkYa8Tqx7ZCVnSI+FwqzuJL1rll1paQdgTZYEtzFiBhI=
services:
- docker
node_js:
- 8.11.3
script:
- npm run test
after_success:
- docker --version
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- echo $AWS_ACCESS_KEY_ID
- echo $AWS_SECRET_ACCESS_KEY
- eval $(aws ecr get-login --no-include-email --region us-east-2)
- docker build -t express-hello .
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- export HELLO_IMAGE_VERSION=$TRAVIS_COMMIT
- node run generateDeployFile
- sudo curl -o ./ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- chmod +x ./ecs-cli
- "./ecs-cli compose down"
- "./ecs-cli compose up"
