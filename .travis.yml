sudo: required
language: node_js
services:
- docker
node_js:
- 8.11.3
script:
- npm run test
after_success:
- docker --version
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- echo $AWS_ACCESS_KEY_ID
- echo $AWS_SECRET_ACCESS_KEY
- echo $FOO
- eval $(aws ecr get-login --no-include-email --region us-east-2)
- docker build -t express-hello .
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- export HELLO_IMAGE_VERSION=$TRAVIS_COMMIT
- node run generateDeployFile
- sudo curl -o ./ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- chmod +x ./ecs-cli
- "./ecs-cli compose down"
- "./ecs-cli compose up"
env:
  global:
  - secure: np9EYX+AyRrqPRZsq1GxHjzzSmO/YTgOndHvVFDTHah8ouZ3mS8YIm+LONk8tJ81R/3Ci6z0ksZ4RzDmpzO6PU5Ezbw0bkFMZ714ViccLT+F2p3wwR7ztSxjzcS0Pu/xtdGOuRMF/S515zgyvDWxyxl8Esdu5rVo9EW2BdPlajWjE5U+hf4kXKNi1X6u7GYcM+woiWxHFj1NYa7OENijbe7tvII1q1SIHU0FD9bG8HmSlJ/R5hdHxgJYmQABjDHFzqA3QHry9mUHuNPe5V14UlALsJGw3am1O9OTPPHTKXQL2anZ1XQBW3cENeA0ktO+F7Xxz3WVV0mqugI/AH0ItznQTMrCunryrJAhioEpQXLI/HDQpB3TQJowko6lnr97JoZU4pn3CHzXEJyh0FsR7b+LmZm13qLRU5QitQMBgjV8w3lVHtBktku6AkU5GxAo33oo/RbBF/wTJfyYx0SU2G6gdYmG0recY2+VH2zO6L+IuTEPqBGfrEq8ppVXq/CzKbt5x8q7fus8dWeHmUroQiiBJ1hGwHFNTDgXhhOljzmf7oMamXq6aB9ddLoFC676JpCyp1FS10ssWE494YR5kphN3sS8kTW6+MsZxJzn07EFYnFShXe0GvDIJnmZ2AJcWXS3OpX3o/iqnmSiZE/cDs/xN95YOUPQvuJiSPDU9SU=
  - secure: wcvf2p1w+L3SPFj3CpgJewPK7e19VHSLWj8GBRD8bOvAWmbM57A/RmvWI1y0IBejEHg4RvWJgkML44liLhzNV6xTq+eBfLoZlTc5fx9pu2lZle3cWvEzQk7DnKmhEJ399t6MQS6iVMu1h5CWm4OyQeDM+tGqXGDe/NSiKLgp3hVFoFt6N8FkelX+yHMjixqBaPCG4ucoN+mrm2PAtfXTMMt5ZH6HOB8UY1qePbh05txSe5Utet4tWAPSC0wz99emh3oTobE0+LCaNAiBOfAdaSS3Fh1++gJD+OtQa7l/P4gzLti9m8mcW4xRc90i90dEGM452tpsxsvPDCYywpAyxegWcaYkGq0E9P342Uwt7bwyyR1StjxeygwSDB9HaXQnTxZxiFZFoEIAAd3BE1W9aHGXR1GPODcl8sHCmzV8r5FZ/Ekf5zKGw2fEZTNyfy044V6RYtO/wO0YAdRWRl1rua83Lww03BQfdJAgLfC6L9nXGjFEJCCiw77sgC4bDVyMAp/3vQKaaHWb4dv/WiJ5dLFYX4vUYLcctixMVCa5m6mtDnFkSh33a3SMW7uN7Yy+tLL9FgyWmO5wPBLsQEENu9SRkakpmodLAWP5eXHenYQ+2x6HlWTdGzuOX7p1Fb4PMMxIu67gPYW5FJRUk+cEX0CJr1Z5+2W+BrMV2g2G3XA=
