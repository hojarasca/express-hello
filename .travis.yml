sudo: required
language: node_js
services:
- docker
node_js:
- 8.11.3
script:
- npm run test
after_success:
- docker --version
- pip install --user awscli
- export PATH=$PATH:$HOME/.local/bin
- echo $AWS_ACCESS_KEY_ID
- echo $AWS_SECRET_ACCESS_KEY
- echo $FOO
- eval $(aws ecr get-login --no-include-email --region us-east-2)
- docker build -t express-hello .
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker tag express-hello:latest 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:$TRAVIS_COMMIT
- docker push 412237081001.dkr.ecr.us-east-2.amazonaws.com/express-hello:latest
- export HELLO_IMAGE_VERSION=$TRAVIS_COMMIT
- node run generateDeployFile
- sudo curl -o ./ecs-cli https://s3.amazonaws.com/amazon-ecs-cli/ecs-cli-linux-amd64-latest
- chmod +x ./ecs-cli
- "./ecs-cli compose down"
- "./ecs-cli compose up"
env:
  global:
  - secure: TuUR9gkA3IkBOhjTTFQCBrdX/Wp9Op/Q+pE1Vb1E8LUtPUsENfe4C6bP0VoQXlR3iBknv5GW4W6KAMa1/83Qap0BaEp2L9Y0T55QYbU4zC7ibK/6ZSVs9ES9Yp2YZcjZDCyufehXsM+qdULxM90fIlIMGDBUw3yZA/FDChjimHSUpmrSjVDRiO4ciL3PBtnILxtYfUrrSMQwsZS7P7VMm1SnrtlNIC32HxBL5pqdefse+zea+H5kUO1grpC3V9wPk1RdXWV/SAJOYJ7rWgdypebn2sgojINvJi1p7//vSJksRj0INLsgh/zRk/QcUFmhAuBqBPivLjrmiLNWuzDJgmWCjSksLSIePSXCKRgpMLiYtfjbemVoYvn2a97kai7vi/vt2UfA5gEmVH1TXCMatcV6GM5fbHOq+2l8IGj5HSvI+E7Nk5x4hlaHckReIqlF67/K8Q5YEm3csFtl/HgNbL0ln3fDT4JPzD/s3NdAe3cIPwM8cNDQvKfK/uijlH1E54WAciCaOgnru63zteZejPldopTvE3JosuSVcGnvp4kvgMtYV5vrQQsU4STIvq8PZ9p4awLjYdWhy3SL+jDQPm2Xd5u3JYoHKsl5ty3ISgLmnBdDgPaah1hS3f7851ZiYiXV63xnN3HbVVjHgI3WlpuIBjOsVC7I2uf5lXYAQeU=
